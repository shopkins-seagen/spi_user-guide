Application Design
==============================

.. include:: nav.rst

**Configuration Files**
--------------------------
Each department has two application configuration files that manage the configuration of the application. 

**Scheduler Configuration**
+++++++++++++++++++++++++++
This file is responsible for the interactive automation manager configuration. |br|
**Location:** I:\\deploy\scheduler_[group]\\Scheduler.exe.config |sp|

The table below describes the keys defined in the configuration file

.. list-table::
  :widths: 30 50 50
  :header-rows: 1

  * - Key
    - Example Value
    - Description
  * - authGroup 
    - GSDB_Admin
    - Domain AD group whose members have access to the application and SQL Server database
  * - dateSubFolderRoot
    - releases
    - Name of the subfolder under Report-level outputs folder to contain date subfolders, if Use data subfolder is checked
  * - emailRgx
    - ^([\\w-\\.]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.)|(([\\w-]+\\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\\]?)$
    - C# regular expression used to validate email recipients
  * - helpUrl
    - https://sgcpapp1:7011/apps/sjm_scheduler/scheduler.html
    - Link to the user guide website
  * - pub
    - U:\\Regulated_Pub\\GSDB\Automation
    - Default path for transfer location in the folder browser dialog 
  * - root
    - S:\\Projects\\GSDB\\automation
    - Default pathr for report location in the folder browser dialog 
  * - run_date
    - Current
    - Value of the enum that specifies current date as the run date 
  * - run_mode
    - Standard
    - Default run mode for interactive submissions within the Automation Manager. This can be modified in the UI
  * - run_qc
    - QC_OFF
    - Default QC level for interactive submissions within the Automation Manager.
  * - summary_subfolder
    - auto_logs
    - Name of the subfolder under [driver path] to store the SAS run summary files generated by the application
  * - iSafeEntities
    - data source=sgcpsql1-dev\dev;initial catalog=GSDB_Automation;
    - Entity data model. The actual value has more elements, but the only configurable portions are the data source and catalog

**Automation Configuration**
+++++++++++++++++++++++++++
This file is responsible for the automation configuration. |br|
**Location:** I:\\deploy\\auto[group]\\RunSAS.exe.config |sp|

The table below describes the keys defined in the configuration file

.. list-table::
  :widths: 30 50 50
  :header-rows: 1

  * - Key
    - Example Value
    - Description
  * - admin	
    - GSDB_Admin or shopkins@seagen.com
    - User or group that will receive email notifications of run status and BCC'd on all reports 
  * - auto_flag	
    - AUTO
    - Enum value that indicates the application should identify reports to run by run date, not a specific CSV file
  * - AutomationEntities
    - data source=sgcpsql1-dev\\dev;initial catalog=GSDB_Automation
    - Connection string to SQL server database. The elements listed in the example are the only properties that can be modified.
  * - current_date	
    - Current
    - Enum value that indicates the application should use the current date as run date, not a date literal passed from the command line
  * - dateFolderFormat	
    - yyyyMMdd
    - Format that the application will create date subfolders under [report outputs]\\{dateSubFolderRoot}
  * - dateSubFolderRoot	
    - releases
    - Name of the folder under [report outputs] that will contain date subfolders
  * - error	
    - ^ERROR(:|.*:)
    - Regular expression that identifies an ERROR in a SAS log file 
  * - failFlag	
    - QC_FAIL!
    - String that matches the value written to the log the QC macro (%mcrBinComp) when data sets are not equal
  * - host	
    - sgsasv1
    - Name of the SAS application server
  * - ignore	
    - (Unable to copy|scheduled to expire)
    - Regular expression that identifies ERRORS or WARNINGS to ignore
  * - isNotifyNoOutputs	
    - TRUE
    - BOOL that indicates if the application should send notifications to {admin} if no reports are scheduled for execution on run date
  * - noRgxMatch	
    - (?!)
    - Regular expression used when the filter field is missing. The default is do not match anything
  * - notes	
    - UNINITIALIZED,REPEATS OF BY VALUES,W.D FORMAT,ASSUMING THE SYMBOL,VALUES HAVE BEEN CONVERTED TO,MISSING VALUES WERE GENERATED AS A RESULT,DIVISION BY ZERO DETECTED DURING,OUTSIDE THE AXIS RANGE,INVALID ARGUMENT TO FUNCTION,MATHEMATICAL OPERATIONS COULD NOT BE PERFORMED,INVALID DATA,MEANING OF AN IDENTIFIER
    - Regular expression to identify NOTES of potential concern in SAS log file
  * - passFlag	
    - QC_PASS!
    - String that matches the value written to the log the QC macro (%mcrBinComp) when data sets are equal
  * - sender	
    - GSDB_Admin@seagen.com
    - Value that will populate in the "From" section of all email reports          
  * - server	
    - SASApp94
    - SAS application server context
  * - smtp_server	
    - sendsmtp.seagen.com
    - SMTP server relay   
  * - smtp_server	
    - sendsmtp.seagen.com
    - SMTP server relay   
  * - userflag	
    - NOTICE:
    - String in the SAS log file that identifies a user-defined message  
  * - warning	
    - ^WARNING(:|.*:)(?!.*Unable to copy)(?!.*scheduled to expire)
    - Regular expression that identifies a WARNING in the SAS log file             
  * - userflag	
    - NOTICE:
    - String in the SAS log file that identifies a user-defined message  
  * - workport	
    - 8591
    - Port for SAS Workspace Server on application server context   


**Database**
+++++++++++++++++++++++++++

Authorized users have reader/writer access on the database to allow for programmatic updates and reporting. The RunLog table collects all the run statistics if user required a 
run summary report that spanned multiple runs. |line|

**Connection Strings**
Development: *sgcpsql1-dev\dev*
Production: *Sgcpsql1\prod,35000*
Database: *[Group]_Automation  (Ex: GSDB_Automation)*

**Enumerations**
There are several fields in the database that capture the integer values of C# enums from the application. See the table below for decoded values

Decoded enums

.. list-table::
  :widths: 20  100
  :header-rows: 1

  * - Database field
    - C# Enum 
  * - EmailTo.EmailType
    - *EmailType* 

        .. list-table::
            :widths: 20 50
            :header-rows: 1

            * - Value
              - Decode
            * - 1
              - To 
            * - 2
              - CC 
            * - 3 
              - BCC 

  * - RunLog.RunType
    - *RunMode* 

        .. list-table::
            :widths: 20 50
            :header-rows: 1

            * - Value
              - Decode
            * - 0
              - Standard               
            * - 1
              - Auto
            * - 2
              - AutoRun 
            * - 3
              - AutoDistribute        
        

       `See Run mode in Parameters <batch.html#Parameters>`__

  * - RunLog.QCStatus, TransferStatus, DistributeStatus
    - *PassQC* 

        .. list-table::
            :widths: 20 50
            :header-rows: 1

            * - Value
              - Decode          
            * - 1
              - Pass
            * - 2
              - Fail 
            * - 3
              - NA (the function was not performed because is was not specified or an error was encountered)      

  * - RunLog.QCStatus, TransferStatus, DistributeStatus
    - *PassQC* 

        .. list-table::
            :widths: 20 50
            :header-rows: 1

            * - Value
              - Decode          
            * - 1
              - Pass
            * - 2
              - Fail 
            * - 3
              - NA (the function was not performed because is was not specified or an error was encountered)      
         
  * - RunLog.ProgramType
    - *ProgramType* 

        .. list-table::
            :widths: 20 50
            :header-rows: 1

            * - Value
              - Decode          
            * - 0
              - NA (e.g. AutoDistribute)
            * - 1 
              - Primary 
            * - 2
              - QC                
       
**Entity Relationship Diagram**

.. image:: _static\erd.png





